[
    # Many regions in Spirit Temple are split between unknown- and known-age variants.
    # Location rules in unknown-age regions check that either both ages have the necessary
    # items or one age is at the known-age variant with the necessary items.

    # Any number of keys can be required to get to the regions blocked by locked doors.
    # The requirements for one-key access include a choice between Mirror Shield to lower
    # the top elevator and longshot weirdshot to clip through it.
    {
        "region_name": "Spirit Temple Lobby",
        "dungeon": "Spirit Temple",
        "exits": {
            "Desert Colossus From Spirit Lobby": "True",
            # Clip with a weirdclip, armos hess, bomb push, or TSC
            "Early Child Spirit Temple": "is_child or (glitch_weirdshot and can_mega) or
                (glitch_slide and can_shield and can_use(Hover_Boots)) or
                (Bombs and (can_shield or can_live_dmg(0.5)) and (Hover_Boots or can_mega)) or
                (glitch_spirit_crawlspace and has_first_person_item)",
            "Early Adult Spirit Temple": "is_adult and (Silver_Gauntlets or
                (glitch_strength2_blocks and (Hover_Boots or can_bomb_slide)) or
                (Bombs and (can_shield or can_live_dmg(0.5))) or
                has_first_person_item)",
            # Age-known access by presence at combinations of locked doors. Access via
            # the lower doors individually is handled at their own regions. Access solely
            # via the hands is handled at Silver Gauntlets Hand Known. Each locked door
            # required is listed explicitly, even if it could be implied by other
            # requirements.
            "Spirit Temple Central Chamber Known": "is_adult and (spirit_temple_shortcuts or
                ((Small_Key_Spirit_Temple, 4) and
                    (('A at Door A1' and 'A at Door C2') or
                    ('A at Door C2' and 'A Access via Top'))) or
                (Small_Key_Spirit_Temple, 3) and
                    'A at Door A1' and 'A at Door C2' and 'A Access via Top')",
            "Child Spirit Temple Climb Known": "
                ((Small_Key_Spirit_Temple, 4) and
                    is_adult and
                        'A at Door C1' and 'A at Door A1') or
                ((Small_Key_Spirit_Temple, 3) and
                    ((is_child and
                        'C at Door C1' and 'C at Door C2' and 'C at Door A2') or
                    (is_adult and
                        (('A at Door C1' and 'A at Door C2' and 'A at Door A2') or
                        ('A at Door C1' and 'A at Door C2' and 'A Access via Top') or
                        ('A at Door A1' and 'A at Door C2' and 'A at Door A2') or
                        ('A at Door A1' and 'A at Door C2' and 'A Access via Top'))))) or
                ((Small_Key_Spirit_Temple, 2) and
                    ((is_child and
                        'C at Door C1' and 'C at Door C2' and 'C at Door A2' and 'C Access via Top') or
                    (is_adult and
                        'A at Door C1' and 'A at Door A1' and at('Desert Colossus', is_adult and can_isg)))) or
                ((Small_Key_Spirit_Temple, 1) and
                    is_adult and
                        (('A at Door C1' and 'A at Door A1' and at('Desert Colossus', can_use(Mirror_Shield) or (can_weirdshot and can_use(Longshot)))) or
                        ('A at Door C1' and 'A at Door C2' and 'A at Door A2' and 'A Access via Top')))"
        }
    },
    {
        "region_name": "Early Child Spirit Temple",
        "dungeon": "Spirit Temple",
        "events": {
            "C at Door C1": "is_child",
            "A at Door C1": "
                is_adult and
                    ((can_weirdshot and Longshot) or
                    (glitch_actor and Hookshot and
                        ((can_shield and Hover_Boots and can_live_dmg(1.0)) or
                        (has_explosives and can_live_dmg(1.5)))))"
        },
        "locations": {
            # Duplicated in Child Spirit Temple Climb Known with alternate requirements
            "Nut Crate": "
                is_child or
                (glitch_actor and Hookshot and
                    ((can_shield and Hover_Boots and can_live_dmg(1.0)) or
                    (has_explosives and can_live_dmg(1.5))))"
        },
        "exits": {
            # Can hookshot the fence and climb the upright bridge to clip through the ceiling
            "Child Spirit Temple Across Bridges": "
                here(
                    is_adult or Sticks or has_explosives or can_use(Megaton_Hammer) or
                    (Nuts and (can_use(Kokiri_Sword) or can_use(Slingshot)) )) and
                here(
                    can_use(Boomerang) or can_use(Slingshot) or can_use(Bow) or can_use(Hookshot) or has_bombchus or
                    can_mega or can_use(Hover_Boots))",
            "Child Spirit Temple Climb Known": "(Small_Key_Spirit_Temple, 5) and (is_child or 'A at Door C1')",
            "Child Spirit Temple Climb Unknown": "(is_child or 'A at Door C1') and
                ((Small_Key_Spirit_Temple, 2) or
                ((Small_Key_Spirit_Temple, 1) and
                    (at('Desert Colossus',
                        can_use(Mirror_Shield) or (can_weirdshot and can_use(Longshot))) or
                    spirit_temple_shortcuts)))"
        }
    },
    {
        "region_name": "Child Spirit Temple Across Bridges",
        "dungeon": "Spirit Temple",
        "locations": {
            "Spirit Temple Child Bridge Chest": "True",
            "Spirit Temple Child Early Torches Chest": "has_fire_source_with_torch or (glitch_qpa and can_isg)",
            "Spirit Temple GS Metal Fence": "True"
        }
    },
    {
        "region_name": "Early Adult Spirit Temple",
        "dungeon": "Spirit Temple",
        "events": {
            "A at Door A1": "is_adult"
        },
        "locations": {
            "Spirit Temple Compass Chest": "can_play(Zeldas_Lullaby) and
                (can_use(Hookshot) or can_use(Hover_Boots) or can_hover)",
            # Both ages can jumpslash the silver rupee without a damage boost.
            # Child is already expected to jumpslash to get to adult side.
            "Spirit Temple Early Adult Right Chest": "can_use_projectile",
            # Clip to the room behind it to hookshot it
            "Spirit Temple GS Boulder Room": "can_use_projectile and
                (can_play(Song_of_Time) or can_use(Hookshot) or can_use(Boomerang))"
        },
        "exits": {
            "Spirit Temple Adult Central Chamber Known": "(Small_Key_Spirit_Temple, 5)",
            "Child Spirit Temple Climb Unknown": "
                (Small_Key_Spirit_Temple, 2) or
                ((Small_Key_Spirit_Temple, 1) and
                    at('Desert Colossus', can_use(Mirror_Shield) or (can_weirdshot and can_use(Longshot))))",
            "Spirit Temple Central Chamber Unknown": "
                (Small_Key_Spirit_Temple, 3) or
                ((Small_Key_Spirit_Temple, 2) and
                    at('Desert Colossus', can_use(Mirror_Shield) or (can_weirdshot and can_use(Longshot))))"
        }
    },
    {
        "region_name": "Child Spirit Temple Climb Known",
        "dungeon": "Spirit Temple",
        "locations": {
            "Nut Crate": "(Small_Key_Spirit_Temple, 5)"
        },
        "exits": {
            "Early Child Spirit Temple": "(Small_Key_Spirit_Temple, 5) and can_weirdshot and can_use(Hookshot)",
            "Spirit Temple Central Chamber Known": "has_explosives"
        }
    },
    {
        "region_name": "Child Spirit Temple Climb Unknown",
        "dungeon": "Spirit Temple",
        "locations": {
            "Spirit Temple Child Climb North Chest": "has_projectile(both) or
                at('Child Spirit Temple Climb Known', can_use_projectile)",
            "Spirit Temple Child Climb East Chest": "has_projectile(both) or
                at('Child Spirit Temple Climb Known', can_use_projectile)",
            "Spirit Temple GS Sun on Floor Room": "(adult_can_equipswap and Boomerang) or
                ((Slingshot or Sticks or Kokiri_Sword or has_explosives or can_use(Dins_Fire) or (child_can_equipswap and Megaton_Hammer)) and (can_live_dmg(0.5) or Fairy or can_use(Nayrus_Love))) or
                at('Child Spirit Temple Climb Known',
                can_use(Boomerang) or can_use(Hookshot) or (is_adult and (can_live_dmg(0.5) or Fairy or can_use(Nayrus_Love))))"
        },
        "exits": {
            "Spirit Temple Central Chamber Unknown": "has_explosives"
        }
    },
    {
        "region_name": "Spirit Temple Central Chamber Known",
        "dungeon": "Spirit Temple",
        "exits": {
            "Spirit Temple Central Chamber Unknown": "True",
            "Spirit Temple Adult Central Chamber Known": "
                can_use(Hookshot) or can_use(Hover_Boots) or can_hover or
                (glitch_spirit_statue and
                    ((is_adult and has_explosives and can_live_dmg(0.5)) or
                    (is_child and (can_jumpslash or can_use(Megaton_Hammer)))))",
            # Ground clip into and out of the Knuckle room
            "Silver Gauntlets Hand Known": "(Small_Key_Spirit_Temple, 5) or
                ((Small_Key_Spirit_Temple, 4) and (can_use(Hookshot) or (can_bomb_slide and can_use(Hover_Boots)))) or
                (can_hover and (can_live_dmg(0.5) or glitch_insane))"
        }
    },
    {
        "region_name": "Spirit Temple Central Chamber Unknown",
        "dungeon": "Spirit Temple",
        "locations": {
            "Spirit Temple Map Chest": "can_use(Dins_Fire) or
                (glitch_qpa and (Kokiri_Sword or (child_can_equipswap and Megaton_Hammer))) or
                ((Bow or glitch_qpa or adult_can_equipswap) and Sticks) or
                at('Spirit Temple Central Chamber Known',
                can_use(Bow) or can_use(Sticks) or (glitch_qpa and is_adult))",
            "Spirit Temple Sun Block Room Chest": "can_use(Dins_Fire) or
                ((Sticks or (glitch_qpa and (Kokiri_Sword or (child_can_equipswap and Megaton_Hammer)) and Deku_Shield)) and
                (Bow or (adult_can_equipswap and Sticks) or (glitch_qpa and (Hylian_Shield or Mirror_Shield)))) or
                at('Spirit Temple Central Chamber Known', can_use(Bow) or can_use(Sticks) or (glitch_qpa and can_isg))",
            "Spirit Temple GS Hall After Sun Block Room": "(adult_can_equipswap and Boomerang) or
                ((Boomerang or child_can_hover) and (Hookshot or adult_can_hover)) or
                at('Spirit Temple Central Chamber Known', can_use(Hookshot) or can_use(Boomerang) or can_hover)",
            "Spirit Temple GS Lobby": "Boomerang or (glitch_megaflip and has_explosives and Deku_Shield) or
                at('Spirit Temple Central Chamber Known', is_adult)"
        },
        "exits": {
            "Spirit Temple Adult Central Chamber Unknown": "
                (child_can_hover or
                (glitch_spirit_statue and
                    (Kokiri_Sword or Sticks or (child_can_equipswap and Megaton_Hammer)))) and

                (Hookshot or Hover_Boots or adult_can_hover or
                (glitch_spirit_statue and has_explosives and can_live_dmg(0.5)) or
                not spirit_temple_shortcuts)",
            "Child Spirit Temple Climb Unknown": "True",
            "Silver Gauntlets Hand Unknown": "child_can_hover and adult_can_hover and
                (can_live_dmg(0.5) or glitch_insane)"
        }
    },
    {
        "region_name": "Spirit Temple Adult Central Chamber Known",
        "dungeon": "Spirit Temple",
        "exits": {
            "Spirit Temple Adult Central Chamber Unknown": "True",
            "Spirit Temple Central Chamber Known": "True",
            "Spirit Temple Before Mirror Shield Known": "has_explosives and
                ((Small_Key_Spirit_Temple, 5) or
                ((Small_Key_Spirit_Temple, 4) and (can_hover or (is_adult and can_shield))))",
            "Spirit Temple Top": "(Small_Key_Spirit_Temple, 5)",
            "Early Adult Spirit Temple": "(Small_Key_Spirit_Temple, 5)",
            "Spirit Temple Before Boss": "glitch_spirit_statue or (spirit_temple_shortcuts and can_use(Hookshot))",
            "Desert Colossus": "(Small_Key_Spirit_Temple, 4) and has_explosives"
        }
    },
    {
        "region_name": "Spirit Temple Adult Central Chamber Unknown",
        "dungeon": "Spirit Temple",
        "locations": {
            "Spirit Temple First Mirror Left Chest": "True",
            "Spirit Temple First Mirror Right Chest": "True",
            "Spirit Temple Statue Room Hand Chest": "can_play(Zeldas_Lullaby)",
            "Spirit Temple Statue Room Northeast Chest": "can_play(Zeldas_Lullaby) and
                ((glitch_megaflip and has_explosives and Deku_Shield) or
                at('Spirit Temple Adult Central Chamber Known', is_adult))"
        },
        "exits": {
            "Spirit Temple Central Chamber Unknown": "True",
            "Spirit Temple Before Mirror Shield Unknown": "(Small_Key_Spirit_Temple, 4) and has_explosives"
        }
    },
    {
        "region_name": "Silver Gauntlets Hand Known",
        "dungeon": "Spirit Temple",
        "events": {
            "C at Door C2": "is_child",
            "A at Door C2": "is_adult"
        },
        "exits": {
            "Silver Gauntlets Hand Unknown": "True",
            "Desert Colossus": "True",
            "Spirit Temple Lobby": "True",
            "Mirror Shield Hand Known": "can_hover or
                (can_use(Hover_Boots) and can_shield and (can_bomb_slide or Megaton_Hammer)) or
                (can_use(Hookshot) and at('Mirror Shield Hand Unknown', True))",
            # Assumed access to either hand if coming from Colossus
            "Spirit Temple Central Chamber Known": "is_adult and
                ((Small_Key_Spirit_Temple, 5) or
                ((Small_Key_Spirit_Temple, 4) and (has_explosives or 'A Access via Top')) or
                ((Small_Key_Spirit_Temple, 3) and has_explosives and 'A Access via Top'))",
            "Child Spirit Temple Climb Unknown": "(Small_Key_Spirit_Temple, 2) or
                ((Small_Key_Spirit_Temple, 1) and 'A Access via Top')"
        }
    },
    {
        "region_name": "Silver Gauntlets Hand Unknown",
        "dungeon": "Spirit Temple",
        "locations": {
            "Spirit Temple Silver Gauntlets Chest": "True"
        },
        "exits": {
            "Mirror Shield Hand Unknown": "child_can_hover and adult_can_hover"
        }
    },
    {
        "region_name": "Mirror Shield Hand Known",
        "dungeon": "Spirit Temple",
        "exits": {
            "Mirror Shield Hand Unknown": "True",
            "Desert Colossus": "True",
            "Spirit Temple Lobby": "True",
            "Silver Gauntlets Hand Known": "can_hover or can_use(Hookshot) or (can_use(Hover_Boots) and can_bomb_slide)",
            "Spirit Temple Before Mirror Shield Known": "True"
        }
    },
    {
        "region_name": "Mirror Shield Hand Unknown",
        "dungeon": "Spirit Temple",
        "locations": {
            "Spirit Temple Mirror Shield Chest": "True"
        },
        "exits": {
            "Silver Gauntlets Hand Unknown": "child_can_hover and (adult_can_hover or Hookshot)",
            "Spirit Temple Before Mirror Shield Unknown": "True"
        }
    },
    {
        "region_name": "Spirit Temple Before Mirror Shield Known",
        "dungeon": "Spirit Temple",
        "events": {
            # Child already has explosives if coming from Colossus
            "C at Door A2": "is_child",
            "A at Door A2": "is_adult and has_explosives",
            "C Access via Top": "is_child and here(can_use(Mirror_Shield) or spirit_temple_shortcuts)",
            # When weirdshotting, use a jumpslash recoil to land on the floor
            # instead of the statue so you don't take fall damage.
            "A Access via Top": "can_use(Mirror_Shield) or (can_weirdshot and can_use(Longshot))"
        },
        "locations": {
            "Spirit Temple Near Four Armos Chest": "can_use(Mirror_Shield)"
        },
        "exits": {
            "Spirit Temple Top": "(Small_Key_Spirit_Temple, 5)",
            "Mirror Shield Hand Known": "True"
        }
    },
    {
        "region_name": "Spirit Temple Before Mirror Shield Unknown",
        "dungeon": "Spirit Temple",
        "locations": {
            "Spirit Temple Hallway Right Invisible Chest": "True",
            "Spirit Temple Hallway Left Invisible Chest": "True"
        },
        "exits": {
            "Mirror Shield Hand Unknown": "True"
        }
    },
    {
        "region_name": "Spirit Temple Top",
        "dungeon": "Spirit Temple",
        "locations": {
            "Spirit Temple Boss Key Chest": "can_play(Zeldas_Lullaby) and (can_live_dmg(1.0) or
                (here(can_use(Bow) or can_qpa or (glitch_qpa and can_isg)) and can_use(Hookshot)))",
            "Spirit Temple Topmost Chest": "can_use(Mirror_Shield)"
        },
        "exits": {
            "Spirit Temple Before Boss": "here(can_use(Mirror_Shield) or spirit_temple_shortcuts) and
                (can_use(Hookshot) or can_hover)"
        }
    },
    {
        "region_name": "Spirit Temple Before Boss",
        "dungeon": "Spirit Temple",
        "exits": {
            "Spirit Temple Boss Door": "
                Boss_Key_Spirit_Temple or
                (glitch_bk_skip_spirit and
                    ((glitch_spirit_statue and can_use(Hover_Boots)) or
                    (can_hover and
                        ((can_live_dmg(0.5) and shuffle_bosses == 'off') or
                        (has_bombchus and
                            ((is_adult and has_2h_sword) or
                            can_use(Sticks) or can_use(Megaton_Hammer))))) or
                    (can_mega and can_use(Iron_Boots))))"
        }
    }
]
